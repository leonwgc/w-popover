import t,{useRef as e,useEffect as n,useState as r,useLayoutEffect as o,useImperativeHandle as i,useCallback as l,useMemo as c}from"react";import u from"react-dom";function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function f(t){for(var e=1;arguments.length>e;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){p(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function p(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(){return d=Object.assign||function(t){for(var e=1;arguments.length>e;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},d.apply(this,arguments)}function m(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;i.length>r;r++)0>e.indexOf(n=i[r])&&(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;i.length>r;r++)0>e.indexOf(n=i[r])&&Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function v(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],l=!0,c=!1;try{for(n=n.call(t);!(l=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);l=!0);}catch(t){c=!0,o=t}finally{try{l||null==n.return||n.return()}finally{if(c)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);e>n;n++)r[n]=t[n];return r}function h(t){var e,n,r="";if("string"==typeof t||"number"==typeof t)r+=t;else if("object"==typeof t)if(Array.isArray(t))for(e=0;t.length>e;e++)t[e]&&(n=h(t[e]))&&(r&&(r+=" "),r+=n);else for(e in t)t[e]&&(r&&(r+=" "),r+=e);return r}function b(){for(var t,e,n=0,r="";arguments.length>n;)(t=arguments[n++])&&(e=h(t))&&(r&&(r+=" "),r+=e);return r}var g=t.createElement("svg",d({viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},{width:"1em",height:"1em",fill:"currentColor"}),t.createElement("path",{d:"M240.512 180.181333l271.530667 271.488 271.530666-271.488a42.666667 42.666667 0 0 1 56.32-3.541333l4.010667 3.541333a42.666667 42.666667 0 0 1 0 60.330667l-271.530667 271.530667 271.530667 271.530666a42.666667 42.666667 0 0 1-56.32 63.872l-4.010667-3.541333-271.530666-271.530667-271.530667 271.530667-4.010667 3.541333a42.666667 42.666667 0 0 1-56.32-63.872l271.488-271.530666-271.488-271.530667a42.666667 42.666667 0 0 1 60.330667-60.330667z","p-id":"2884"})),w=function(e){return t.createElement("div",e,g)};function O(t){var n=e(t);return n.current=t,n}w.displayName="Close";var x=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=e(!1);n((function(){if(o.current)return t();o.current=!0}),r)},C=function(t){var e,n=t.current;return n instanceof HTMLElement?e=n:n.current?e=n.current:"function"==typeof n&&(e=n()),e},E=function(t,e){return t?"function"==typeof t?t():t&&"current"in t?t.current:t:e},j=function(t,e,n){if("object"===s(e)&&e)for(var r=0,o=Object.keys(e);o.length>r;r++){var i=o[r];t.style[i]=e[i]}else"string"==typeof e&&(t.classList.add(e),"string"==typeof n&&n&&t.classList.contains(n)&&t.classList.remove(n))};function k(t,i,l,c){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:220,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,f=r(i),s=v(f,2),p=s[0],d=s[1],m=O(t),y=e(0),h=O(l),b=O(c);return o((function(){var t=C(m);i&&(j(t,h.current,b.current),d(!0),y.current=window.setTimeout((function(){j(t,b.current,h.current)}),a))}),[i,p,h,b,m,a]),x((function(){if(!i&&p){var t=C(m);y.current=window.setTimeout((function(){j(t,h.current,b.current),y.current=window.setTimeout((function(){d(!1)}),u)}),a)}}),[i]),n((function(){return function(){y.current&&clearTimeout(y.current)}}),[]),p||i}var S=["children","visible","style","hideOverflow"],P=t.forwardRef((function(r,o){var l=r.children,c=r.visible,u=r.style,a=r.hideOverflow,s=void 0===a||a,p=m(r,S),v=e(null),y=e("");i(o,(function(){return v.current}));var h=k((function(){return v.current}),c,{opacity:0},{opacity:.5},300);return n((function(){return y.current=document.body.style.overflow,document.body.style.overflow=c&&s?"hidden":y.current,function(){document.body.style.overflow=y.current}}),[c,s]),h?t.createElement("div",d({ref:v},p,{style:f(f({},u),{},{opacity:0,background:"rgba(0, 0, 0)",zIndex:1e3,position:"fixed",left:0,top:0,bottom:0,right:0,width:"100%",touchAction:"none",display:h?"":"none",transition:"opacity 200ms linear"})}),l):null}));P.displayName="W-Mask";var N=function(t){return"[object Number]"===Object.prototype.toString.call(t)&&t==t},A=function(t){var e;return t instanceof HTMLElement?e=t:"[object Object]"===Object.prototype.toString.call(t)&&"current"in t?e=t.current:"function"==typeof t&&(e=null==t?void 0:t()),e},L={top:"bottom",bottom:"top",left:"right",right:"left"};function M(t,e,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=O(r),l=O(e),c=O(t),u=O(o);n((function(){var t=E(c.current,window);if(null==t?void 0:t.addEventListener){var e=function(t){var e;return null===(e=i.current)||void 0===e?void 0:e.call(i,t)},n=l.current,r=u.current;return t.addEventListener(n,e,r),function(){t.removeEventListener(n,e,r)}}}),[])}var T,D=["left","top","placement","style"];var I=function(t){if(""+t!="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t},z=function(t){return function(t){return(_(t)?t.ownerDocument:t.document)||window.document}(t).documentElement},B=function(t){return I(t).getComputedStyle(t)},H=function(t){return t?(t.nodeName||"").toLowerCase():""},R=function(t){return t&&"html"!==H(t)?t.assignedSlot||t.parentNode||z(t):t},_=function(t){return t instanceof I(t).Element||t instanceof Element},F=function(t){return t instanceof I(t).HTMLElement||t instanceof HTMLElement},V=function(t){return["table","td","th"].indexOf(H(t))>=0},q=function(t){return F(t)&&"fixed"!==B(t).position?t.offsetParent:null},W=function(t,e){var n=I(t);null==e||e(t);for(var r=q(t);r&&V(r)&&"static"===B(r).position;)null==e||e(r),r=q(r);return r||function(t,e){null==e||e(t);for(var n=R(t);F(n)&&0>["html","body"].indexOf(H(n));){null==e||e(n);var r=B(n);if("none"!==r.transform||"none"!==r.perspective||r.willChange&&"auto"!==r.willChange)return n;n=R(n)}return n}(t,e)||n},Y=function(t){var e=0;return W(t,(function(t){e+=t.offsetTop})),e},U=function(t,e){for(var n=R(t);F(n)&&0>["html","body"].indexOf(H(n));){var r=B(n).overflowY,o="visible"!==r&&"hidden"!==r;if(null==e||e(n),o&&n.scrollHeight>n.clientHeight)return n;n=n.parentNode}return z(t)},$=function(t,e,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bottom",i=arguments.length>5?arguments[5]:void 0,l=t.getBoundingClientRect(),c=e.getBoundingClientRect(),u=n.getBoundingClientRect(),a="body"===H(n),f="fixed"===B(e).position,s=f?c.top:a?c.top+window.pageYOffset:Y(e),p=s,d=c.height+s,m=c.left-(f?0:u.left),v=c.width,y=c.height,h={top:{top:p-l.height-12,left:m+v/2-l.width/2},bottom:{top:d+12,left:m+v/2-l.width/2},left:{top:p+y/2-l.height/2,left:m-l.width-12},right:{top:p+y/2-l.height/2,left:m+v+12},"top-right":{top:p-l.height-12,left:m+v-l.width},"top-left":{top:p-l.height-12,left:m},"bottom-right":{top:d+12,left:m+v-l.width},"bottom-left":{top:d+12,left:m},"right-top":{top:p,left:m+v+12},"left-top":{top:p,left:m-l.width-12},"right-bottom":{top:d-l.height,left:m+v+12},"left-bottom":{top:d-l.height,left:m-l.width-12}},b={x:i.x||0,y:i.y||0},g=h[o];return{position:f?"fixed":"absolute",top:Math.max(g.top+b.y,0),left:Math.max(g.left+b.x,0)}},G=function(t){return{bottom:"top",top:"bottom",left:"right",right:"left"}[t]},J=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,o=t.getBoundingClientRect(),i=e.split("-"),l=v(i,2),c=l[0],u=l[1],a={top:"1px 1px 1px 0px rgba(0, 0, 0, 0.05)",right:"-1px 1px 1px 0px rgba(0, 0, 0, 0.05)",bottom:"-1px -1px 1px 0px rgba(0, 0, 0, 0.05)",left:"1px -1px 1px 0px rgba(0, 0, 0, 0.05)"},s=p({boxShadow:a[c]},G(c),-r/2);if(u)return f(p({},u,2*n),s);var d={};return["bottom","top"].includes(c)&&(d.right=(o.width-r)/2),["left","right"].includes(c)&&(d.top=(o.height-r)/2),f(f({},d),s)},K=["placement","content","arrow","visible","closable","onVisibleChange","onClose","className","style","children","mask","maskStyle","maskClass","mountContainer","closeOnClickOutside","closeOnMaskClick","transition","transitionDuration","offset"],Q=function(t,e){var n=t;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return n}((function(n){var i=n.placement,a=void 0===i?"bottom":i,s=n.content,p=n.arrow,y=void 0===p||p,h=n.visible,g=n.closable,C=n.onVisibleChange,E=n.onClose,j=n.className,S=n.style,N=n.children,T=n.mask,D=n.maskStyle,I=n.maskClass,z=n.mountContainer,B=void 0===z?document.body:z,H=n.closeOnClickOutside,R=void 0===H||H,_=n.closeOnMaskClick,F=void 0===_||_,V=n.transition,q=void 0===V||V,W=n.transitionDuration,Y=void 0===W?200:W,G=n.offset,Q=void 0===G?{}:G,X=m(n,K),Z=e(),tt=e(null),et=e(0),nt=O(Q),rt=O(E),ot=v(r({}),2),it=ot[0],lt=ot[1],ct=A(B),ut=e(!1);x((function(){null==C||C(h)}),[h]);var at=t.useCallback((function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=tt.current,o=$(r,t,document.body,e,a,nt.current),i=J(r,a,12);r.style.transitionProperty="none",r.style.top=o.top+"px",r.style.left=o.left+"px",r.style.position=o.position,q&&n&&(r.style.visibility="hidden",r.style.opacity="0",r.style.transform="scale(0)",r.style.transitionProperty="transform, opacity",r.style.visibility="visible"),lt(i)}),[q,a,nt]),ft=function(){var t=Z.current,e=U(t);at(t,e),et.current&&window.cancelAnimationFrame(et.current),et.current=window.requestAnimationFrame((function(){at(t,e)}))};M((function(){return window}),"resize",h?ft:null),M((function(){return window}),"scroll",h?ft:null),o((function(){var t=Z.current,e=U(t);h?(at(t,e,!ut.current),ut.current=!0):ut.current=!1}),[h,at]);var st=l((function(t){var e,n=tt.current,r=Z.current;!n||n.contains(t.target)||r.contains(t.target)||(null===(e=rt.current)||void 0===e||e.call(rt))}),[rt]);M((function(){return document}),"click",R?st:null);var pt=c((function(){return function(t){var e=t.split("-"),n="";return e[0]&&(n+=L[e[0]]),e[1]&&(n+=" "+e[1]),n}(a)}),[a]),dt=k((function(){return tt.current}),h,{opacity:0,transform:"scale(0)"},{opacity:1,transform:"scale(1)"},Y);return t.createElement(t.Fragment,null,t.createElement(P,{visible:T&&h,className:I,style:D,onClick:function(){F&&(null==E||E())}}),t.cloneElement(N,{ref:Z}),u.createPortal(t.createElement(t.Fragment,null,dt&&t.createElement("div",d({},X,{ref:tt,className:b(j,"w-popover"),style:f({position:"absolute",background:"#fff",zIndex:1e3,transformOrigin:pt,transitionDuration:"".concat(Y,"ms"),transitionProperty:"none",willChange:"transform, opacity"},S)}),y&&t.createElement("div",{className:b("w-popover__arrow"),style:f({position:"absolute",width:6,height:6,zIndex:-1,background:"inherit",transform:"rotate(45deg)"},it)}),g&&t.createElement(w,{className:b("w-popover__close"),onClick:E,style:{position:"absolute",zIndex:10,top:6,right:6,cursor:"pointer",color:"rgb(0,0,0)",opacity:.35,display:"flex",alignItems:"center",justifyContent:"center"}}),s)),ct))}),{show:function(e){var n,r=e.left,o=e.top,i=e.placement,l=void 0===i?"top":i,c=e.style,a=m(e,D),f=e.anchor,s=r,p=o,v=document.createElement("div");T&&(null===(n=T)||void 0===n||n());var y=0,h=0;if(!N(s)||!N(p)){if(!f)throw Error("no anchor / left,top");if("string"==typeof f?f=document.querySelector(f):"current"in f&&(f=f.current),!(f instanceof Element))throw Error("no anchor found");var b=f.getBoundingClientRect();s=b.left,p=b.top,y=b.width,h=b.height}var g=function(t,e){var n=e||document.createElement("div");document.body.appendChild(n),u.render(t,n);var r=function(){u.unmountComponentAtNode(n),n&&n.parentNode&&n.parentNode.removeChild(n)};return function(t){"function"==typeof t?t().then(r):r()}}(t.createElement(Q,d({closeOnClickOutside:!1,onClose:function(){return g()},visible:!0,transition:!1,style:c,placement:l},a),t.createElement("span",{style:{position:"fixed",left:s,top:p,width:y,height:h,visibility:"hidden",pointerEvents:"none"},className:"w-popover__anchor"})),v);return T=g,g},hide:function(){"function"==typeof T&&T()}});export default Q;
